environment: dev                         # Optional override: env=dev/test/prod affects Bronze/Silver root paths.
domain: finance                         # Optional business domain used in Silver foldering/metadata.
system: payments                        # Required: source system name, drives Bronze bucket layout.
entity: transactions                    # Required: logical entity name used across Bronze/Silver.
bronze_status: pending                  # Optional note you can inspect/propagate downstream (e.g., ready/pending).

datasets:
  - name: transactions                                # Friendly label for ops; appears in metadata/checklist.
    system: payments                                 # Repeat the system (keeps configs copy-paste friendly).
    entity: transactions                             # Repeat entity for explicitness.
    environment: dev                                 # Optional per-dataset override (falls back to root environment).
    domain: finance                                  # Optional domain override (defaults from root `domain` if omitted).

    bronze:
      enabled: true                                  # Defaults to true; set false if you only want Silver from pre-existing Bronze.
      source_type: db                                # Choose one of: db, file, api, custom.
      connection_name: PAYMENTS_PROD                 # Required for db/api/custom sources; can point to env var name.
      source_query: |                                # Optional SQL; required for db unless you embed base_query in options.db.
        select tx_id, amount, status, updated_at
        from phoenix.transactions
        where updated_at >= :since
      path_pattern: ./sampledata/source_samples/pattern1_full_events/system=payments/table=transactions/pattern=pattern1_full_events/dt=2025-11-13/
                                                     # Required for file sources. Placeholders (e.g., dt=...) are honored by samples generator.
      partition_column: updated_at                    # Optional column used for Bronze partitioning; defaults to load_time if omitted.
      owner_team: payments-platform                   # Optional; propagates into manifest/metadata.
      owner_contact: ops@example.com                  # Optional contact email for Bronze ownership.
      options:
        format: parquet                               # File format; common values: parquet, csv.
        load_pattern: full                            # Load pattern hint: full, cdc, current_history, incremental, etc.
        max_rows_per_file: 500000                     # Controls Bronze chunk size; defaults to unlimited.
        max_file_size_mb: 256                         # Optional soft cap on bytes per file for downstream readers.
        parallel_workers: 2                           # Optional Bronze parallelism hint.
        partitioning_strategy: date                   # Optional helper for partition-aware buckets (date/hour/batch_id/timestamp).
        file:
          csv_delimiter: ","                           # Namespace for format-specific overrides.
        db:
          base_query: null                             # Optional alternative to source_query for db sources.
        api:
          base_url: https://api.example.com            # API-specific options live under `api`.
          endpoint: "/transactions"
          auth_type: bearer
        custom_extractor:
          module: my_custom.extractor
          entrypoint: run

    silver:
      enabled: true                                  # Defaults true; disable if promoting is not required.
      entity_kind: event                             # Required: event | state | derived_state | derived_event.
      history_mode: scd2                             # Required for state-like kinds; defaults to scd2 (scd1/latest_only also allowed).
      input_mode: append_log                          # Only valid for event/derived_event; defaults to append_log, can be replace_daily.
      delete_mode: ignore                             # Optional guardrail: ignore | tombstone_state | tombstone_event.
      schema_mode: strict                             # Strict raises on unexpected columns; allow_new_columns skips them.
      natural_keys:
        - tx_id
      event_ts_column: processed_at                   # Required for event-like datasets.
      change_ts_column: processed_at                  # Required for state-like datasets.
      attributes:
        - status
        - amount
        - customer_id
      partition_by:
        - event_ts_date                                # Optional partition hints; Silver adds columns if suffix `_dt` is missing.
      output_dir: ./silver/payments                     # Optional override of Silver base path (defaults to ./silver or env-aware root).
      version: 1                                      # Optional version number for Silver assets (defaults to 1).
      load_partition_name: load_date                  # Folder name for partition values (defaults to load_date).
      include_pattern_folder: false                   # When true, Silver writes under pattern=<entity_kind> to match Bronze.
      require_checksum: true                          # Optional; if true, Silver validates `_checksums.json` before running.
      semantic_owner: finance-analytics-team          # Optional semantic owner metadata for Silver assets.
      semantic_contact: analytics@example.com         # Optional contact.

      # Advanced tuning (mostly optional):
      # - leave histogram fields commented out, defaults are safe.
      # - schema/normalization/error handling can be set via `silver.output_dir`'s typed config if you need more control.
