# DATABASE EXTRACTION EXAMPLE
# This demonstrates extracting data from a SQL database with an SCD-friendly Silver intent.

environment: test
domain: claims

system: claims_dw
entity: claims_header

bronze:
  enabled: true
  source_type: db
  connection_name: CLAIMS_DB_CONN_STR
  source_query: |
    SELECT TOP 100
        ClaimID,
        MemberID,
        ServiceDate,
        Amount,
        LastUpdated
    FROM dbo.ClaimsHeader
  partition_column: load_date
  options:
    load_pattern: full
    db:
      statement_timeout_seconds: 600
    max_rows_per_file: 200000                                # keep downstream files within 200k rows
    max_file_size_mb: 128                                    # help analytics engines ingest faster
    parallel_workers: 4                                      # read chunks concurrently
    owner_team: claims-platform
    owner_contact: claims-platform@example.com

silver:
  enabled: true

  entity_kind: state                  # claims header is a slowly changing dimension
  history_mode: scd1                  # only need the current view
  delete_mode: ignore
  schema_mode: strict

  natural_keys:
    - ClaimID

  change_ts_column: LastUpdated

  attributes:
    - MemberID
    - ServiceDate
    - Amount

  partition_by:
    - LastUpdated_dt
  semantic_owner: claims-analytics
  semantic_contact: claims-analytics@example.com
