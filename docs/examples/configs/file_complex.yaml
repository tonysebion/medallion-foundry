environment: prod
domain: retail_demo

datasets:
  - name: current_history_orders
    system: retail_demo
    entity: orders_snapshot

    bronze:
      enabled: true
      source_type: file
      path_pattern: ./docs/examples/data/bronze_samples/current_history/system=retail_demo/table=orders/pattern=current_history/dt=2025-11-03/
      partition_column: load_date
      owner_team: platform-ops
      owner_contact: ops@example.com
      options:
        format: parquet
        load_pattern: current_history
        columns:
          - OrderID
          - Status
          - UpdatedAt
        max_rows_per_file: 250000            # limit file size for downstream readers
        max_file_size_mb: 256                # cap chunk size in megabytes
        parallel_workers: 3                  # process multiple files in parallel

    silver:
      enabled: true
      semantic_owner: analytics-team
      semantic_contact: analytics@example.com

      entity_kind: state
      history_mode: scd2
      delete_mode: tombstone_state
      schema_mode: allow_new_columns

      natural_keys:
        - OrderID

      change_ts_column: UpdatedAt

      attributes:
        - Status

      partition_by:
        - effective_from_dt

  - name: cdc_orders
    system: retail_demo
    entity: orders_cdc

    bronze:
      enabled: true
      source_type: file
      path_pattern: ./docs/examples/data/bronze_samples/cdc/system=retail_demo/table=orders/pattern=cdc/dt=2025-11-02/
      partition_column: load_date
      options:
        format: csv
        load_pattern: cdc
        max_rows_per_file: 150000
        partitioning_strategy: batch_id        # signal Bronze to tag partitions for multi-run resends

    silver:
      enabled: true

      entity_kind: event
      input_mode: append_log
      delete_mode: tombstone_event
      schema_mode: strict

      natural_keys:
        - OrderID

      event_ts_column: UpdatedAt
      change_ts_column: UpdatedAt

      attributes:
        - Status
