environment: dev
domain: customer_360

system: customers
entity: base

bronze:
  enabled: true
  source_type: db
  connection_name: CUSTOMER_DB_CONN                 # connection string stored in env/secret store
  source_query: |
    SELECT CustomerID, Name, UpdatedAt
    FROM dbo.Customers
  partition_column: load_dt
  options:
    load_pattern: full

silver:
  enabled: true

  entity_kind: state                                 # customer record is a stateful dimension
  history_mode: scd2
  delete_mode: tombstone_state
  schema_mode: allow_new_columns

  natural_keys:
    - CustomerID

  change_ts_column: UpdatedAt

  attributes:
    - Name

  partition_by:
    - effective_from_dt
